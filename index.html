<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SISTEMA TWINS V24</title>
    <style>
        :root { --bg: #000; --card: #121212; --text: #fff; --primary: #3498db; --border: #333; }
        [data-theme="light"] { --bg: #f4f7f6; --card: #fff; --text: #333; --border: #ddd; }
        
        body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; padding: 15px; transition: 0.3s; }
        .pantalla { display: none; }
        .activa { display: block !important; }
        
        .card { background: var(--card); padding: 15px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 15px; }
        .btn { width: 100%; padding: 18px; border-radius: 12px; border: none; font-size: 16px; font-weight: bold; cursor: pointer; margin: 8px 0; display: block; text-align: center; text-decoration: none; }
        .btn-user { background: var(--card); color: var(--primary); border: 1px solid var(--primary); }
        .btn-main { background: var(--primary); color: #fff; }
        
        input, select { width: 100%; padding: 14px; margin: 8px 0; border-radius: 8px; border: 1px solid var(--border); background: var(--card); color: var(--text); font-size: 16px; box-sizing: border-box; }
        .badge { background: var(--primary); color: #fff; padding: 5px 12px; border-radius: 15px; font-size: 20px; }
    </style>
</head>
<body data-theme="dark">

    <div id="p1" class="pantalla activa">
        <h1 style="text-align:center; color:var(--primary);">SISTEMA TWINS</h1>
        <p style="text-align:center; opacity:0.6;">Seleccione su nombre:</p>
        
        <div class="btn btn-user" onclick="window.operario='TAJHO'; document.getElementById('nom-u').innerText='üë§ TAJHO'; document.getElementById('p1').style.display='none'; document.getElementById('p2').style.display='block';">TAJHO</div>
        <div class="btn btn-user" onclick="window.operario='FRANCESCO'; document.getElementById('nom-u').innerText='üë§ FRANCESCO'; document.getElementById('p1').style.display='none'; document.getElementById('p2').style.display='block';">FRANCESCO</div>
        <div class="btn btn-user" onclick="window.operario='OSCAR'; document.getElementById('nom-u').innerText='üë§ OSCAR'; document.getElementById('p1').style.display='none'; document.getElementById('p2').style.display='block';">OSCAR</div>
        
        <div class="btn" style="background:none; color:var(--primary); font-size:14px;" onclick="document.body.setAttribute('data-theme', document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');">üåì Cambiar Modo Claro/Oscuro</div>
    </div>

    <div id="p2" class="pantalla">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <b id="nom-u"></b>
            <button onclick="location.reload()" style="background:none; border:none; color:red;">SALIR</button>
        </div>

        <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
            <span>Cajas en carga:</span>
            <b id="suma-total" class="badge">0</b>
        </div>

        <div class="card">
            <input type="text" id="cli" placeholder="CLIENTE / DESTINO">
            <input type="number" id="can" placeholder="CANTIDAD CAJAS" inputmode="numeric">
            <button class="btn btn-main" onclick="agregar()">+ A√ëADIR DESPACHO</button>
        </div>

        <div id="area-envio" style="display:none;">
            <div id="lista" class="card" style="font-size:14px; color:#888;"></div>
            <select id="cho"><option value="">Seleccione Chofer...</option><option value="ROMARIO">ROMARIO</option><option value="CESAR">CESAR</option></select>
            <select id="pla"><option value="">Seleccione Placa...</option><option value="BUL742">BUL742</option><option value="BPN104">BPN104</option></select>
            <button class="btn btn-main" style="background:#2ecc71;" onclick="enviar()">‚úÖ ENVIAR WHATSAPP</button>
            <button class="btn" style="background:#444; color:#fff; font-size:14px;" onclick="anexo()">üì¶ AGREGAR ANEXO</button>
        </div>
        
        <button class="btn" style="border:1px solid var(--border); color:var(--text); font-size:14px;" onclick="document.getElementById('p2').style.display='none'; document.getElementById('p3').style.display='block';">üìã VER HISTORIAL</button>
    </div>

    <div id="p3" class="pantalla">
        <button class="btn" onclick="document.getElementById('p3').style.display='none'; document.getElementById('p2').style.display='block';">‚Üê VOLVER</button>
        <input type="text" id="bus" onkeyup="buscar()" placeholder="üîç Buscar cliente...">
        <div style="overflow-x:auto; margin-top:10px;">
            <table style="width:100%; border-collapse:collapse; font-size:12px;">
                <thead><tr style="background:var(--primary); color:#fff;"><th>Cliente</th><th>Cjs</th><th>Chofer</th></tr></thead>
                <tbody id="tabla"><tr><td colspan="3" style="text-align:center; padding:20px;">No hay registros</td></tr></tbody>
            </table>
        </div>
    </div>

    <script>
        window.items = [];
        window.totalCajas = 0;
